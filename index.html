<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Claim Approval Survey Report</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Segoe UI, Arial;
  background:#f4f6f8;
  margin:0;
  padding:15px;
}
h2,h3{margin:10px 0}
.card{
  background:#fff;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
  box-shadow:0 3px 10px rgba(0,0,0,.08);
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:10px;
}
input,select,textarea{
  width:100%;
  padding:8px;
  box-sizing:border-box;
  word-wrap:break-word;
}
textarea{
  resize:vertical;
  min-height:60px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
  vertical-align:top;
}
th{background:#f0f0f0}
.btn{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.add{background:#198754;color:#fff}
.del{background:#dc3545;color:#fff}
.save{background:#0d6efd;color:#fff;width:100%;font-size:16px}
.print{background:#6c757d;color:#fff;width:100%;margin-top:8px}

@media print{
  .add,.del,.save,.print,select,button{display:none!important}
  body{background:#fff}
}
</style>
</head>

<body>

<h2>üìÑ Claim Approval Parts Survey Report</h2>

<div class="card">
<h3>Insurance / Survey Details</h3>
<div class="grid">
<input id="insurance" placeholder="Insurance Company">
<input id="surveyor" placeholder="Surveyor Name">
<input id="surveyMobile" placeholder="Surveyor Mobile">
<input id="customer" placeholder="Customer Name">
<input id="customerMobile" placeholder="Customer Mobile">
<input id="frame" placeholder="Frame Number">
<input id="jobcard" placeholder="Job Card Number">
<input id="intimation" type="date">
<input id="surveyDate" type="date">
</div>
</div>

<!-- APPROVED PARTS -->
<div class="card">
<h3>Approved Parts</h3>
<table id="approvedTable">
<tr>
<th>Sr</th><th>Part No</th><th>Description</th>
<th>Qty</th><th>Remark</th><th>‚ùå</th>
</tr>
</table>
<button class="btn add" onclick="addApproved()">‚ûï Add Part</button>
</div>

<!-- LABOUR -->
<div class="card">
<h3>Denting / Painting / Labour Approval</h3>
<table id="labourTable">
<tr>
<th>Sr</th><th>Type</th><th>Description</th>
<th>Qty</th><th>Amount</th><th>‚ùå</th>
</tr>
</table>
<button class="btn add" onclick="addLabour()">‚ûï Add Work</button>
</div>

<!-- PENDING -->
<div class="card">
<h3>Approval Pending (Parts / Labour)</h3>
<table id="pendingTable">
<tr>
<th>Sr</th><th>Type</th><th>Description</th>
<th>Qty</th><th>Status</th><th>‚ùå</th>
</tr>
</table>
<button class="btn add" onclick="addPending()">‚ûï Add Pending</button>

<br><br>
<button class="btn save" onclick="downloadPendingPDF()">‚¨áÔ∏è Download Pending Approval PDF</button>
</div>

<div class="card">
<button class="btn save" onclick="saveReport()">üíæ Save Report</button>
<button class="btn print" onclick="window.print()">üñ®Ô∏è Print Report</button>
</div>

<div style="text-align:center;font-size:14px">
<b>Shri Ganesh Motors</b><br>
Near Bus Stand, Bilara Road, Borunda<br>
üìû 6376978548 | ‚úâÔ∏è shriganeshmotors734@gmail.com
<br><br>
<i>
This is a final survey report based on approval received via WhatsApp, Gmail
or physical confirmation. Kindly verify the details before work initiation.
</i>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxINVWdtlJK2R3KT2N4H9j4iGjNksr2Nvw5_cbINPMN5NTI3U_9gXa054tgqzWhex0bRA/exec";
let a=1,l=1,p=1;

function addApproved(){
approvedTable.insertAdjacentHTML("beforeend",`
<tr>
<td>${a++}</td>
<td><input></td>
<td><textarea></textarea></td>
<td><input type="number"></td>
<td><textarea></textarea></td>
<td><button class="btn del" onclick="this.closest('tr').remove()">X</button></td>
</tr>`);
}

function addLabour(){
labourTable.insertAdjacentHTML("beforeend",`
<tr>
<td>${l++}</td>
<td>
<select>
<option>Denting / Painting</option>
<option>Painting</option>
<option>Denting</option>
<option>Repair</option>
<option>Labour</option>
</select>
</td>
<td><textarea></textarea></td>
<td><input type="number"></td>
<td><input type="number"></td>
<td><button class="btn del" onclick="this.closest('tr').remove()">X</button></td>
</tr>`);
}

function addPending(){
pendingTable.insertAdjacentHTML("beforeend",`
<tr>
<td>${p++}</td>
<td><input></td>
<td><textarea></textarea></td>
<td><input type="number"></td>
<td>
<select>
<option>Pending</option>
<option>Approved</option>
<option>Done</option>
</select>
</td>
<td><button class="btn del" onclick="this.closest('tr').remove()">X</button></td>
</tr>`);
}

function saveReport(){

  let rows = [];

  /* ===== APPROVED PARTS ===== */
  document.querySelectorAll("#approvedTable tr").forEach((tr, idx)=>{
    if(idx === 0) return;

    const tds = tr.querySelectorAll("td");
    const inputs = tr.querySelectorAll("input, textarea");

    if(inputs.length < 3) return;

    rows.push({
      sectionType: "APPROVED",
      sr: tds[0].innerText,
      type: "PART",
      partNo: inputs[0].value,
      description: inputs[1].value,
      qty: inputs[2].value,
      amount: "",
      remark: inputs[3].value || "",
      status: "APPROVED"
    });
  });

  /* ===== LABOUR ===== */
  document.querySelectorAll("#labourTable tr").forEach((tr, idx)=>{
    if(idx === 0) return;

    const tds = tr.querySelectorAll("td");
    const typeSel = tr.querySelector("select");
    const inputs = tr.querySelectorAll("input, textarea");

    if(!typeSel || inputs.length < 3) return;

    rows.push({
      sectionType: "LABOUR",
      sr: tds[0].innerText,
      type: typeSel.value,
      partNo: "",
      description: inputs[0].value,
      qty: inputs[1].value,
      amount: inputs[2].value,
      remark: "",
      status: "APPROVED"
    });
  });

  /* ===== PENDING ===== */
  document.querySelectorAll("#pendingTable tr").forEach((tr, idx)=>{
    if(idx === 0) return;

    const tds = tr.querySelectorAll("td");
    const inputs = tr.querySelectorAll("input, textarea");
    const statusSel = tr.querySelector("select");

    if(inputs.length < 2 || !statusSel) return;

    rows.push({
      sectionType: "PENDING",
      sr: tds[0].innerText,
      type: inputs[0].value,
      partNo: "",
      description: inputs[1].value,
      qty: inputs[2]?.value || "",
      amount: "",
      remark: "",
      status: statusSel.value
    });
  });

  if(rows.length === 0){
    alert("‚ùå Koi data add nahi kiya gaya");
    return;
  }

  /* ===== SEND TO GOOGLE SHEET ===== */
  fetch(API_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      insurance: insurance.value,
      surveyor: surveyor.value,
      surveyMobile: surveyMobile.value,
      customer: customer.value,
      customerMobile: customerMobile.value,
      frame: frame.value,
      jobcard: jobcard.value,
      intimation: intimation.value,
      surveyDate: surveyDate.value,
      rows: rows
    })
  })
  .then(res => res.json())
  .then(res => {
    if(res.status === "SUCCESS"){
      alert("‚úÖ Google Sheet me data save ho gaya\nRows: " + res.rowsInserted);
    }else{
      alert("‚ùå ERROR: " + res.message);
    }
  })
  .catch(err=>{
    console.error(err);
    alert("‚ùå Network / Script error");
  });
}
</script>

</body>
</html>
